{"name":"LENA Migration Tool","tagline":"","body":"# (LENA) Lambda Executed NAt Migration Tool\r\nAutomated legacy NAT to NAT gateway migration tool\r\n\r\n##### IANAD - Fair warning.  This is a project for fun and educational purposes.  Please review before using as there are no warranties.\r\n\r\n## Description\r\nLENA migration tool is a simple cloudformation template that creates a custom resource lambda function that will take your inputs and use them to create a new NAT gateway (in the same subnet as your NAT instance) and update all your route tables that have the NAT instance id to the new NAT gateway id.  Additionally, if you choose, it can migrate the current NAT instance EIP to the new NAT gateway.\r\n\r\n## How To Use\r\nSimply clone this repo to acquire both the lambda and CFT.  Then deploy the CFT in a region where you want to migrate the NAT instance to a NAT gateway.  You'll need to make a note of your NAT instance id before you start and decide whether you want to migrate the EIP off of the NAT or not.\r\n\r\nHere's what the options in the template look like\r\n![lena template image](https://github.com/coingraham/lena/blob/master/cloudformationtemplate/templatescreenshot.png)\r\n\r\n## What it creates\r\nThe CFT will create a python based lambda with a lambda assumer role and the following policies attached:\r\n```json\r\n    \"Policies\": [\r\n        {\r\n            \"PolicyName\": \"root\",\r\n            \"PolicyDocument\": {\r\n                \"Version\": \"2012-10-17\",\r\n                \"Statement\": [\r\n                    {\r\n                        \"Effect\": \"Allow\",\r\n                        \"Action\": [\r\n                            \"logs:CreateLogGroup\",\r\n                            \"logs:CreateLogStream\",\r\n                            \"logs:PutLogEvents\"\r\n                        ],\r\n                        \"Resource\": \"arn:aws:logs:*:*:*\"\r\n                    },\r\n                    {\r\n                        \"Sid\": \"LenaMigrationPolicy\",\r\n                        \"Effect\": \"Allow\",\r\n                        \"Action\": [\r\n                            \"ec2:AllocateAddress\",\r\n                            \"ec2:CreateNatGateway\",\r\n                            \"ec2:CreateRoute\",\r\n                            \"ec2:CreateTags\",\r\n                            \"ec2:DeleteRoute\",\r\n                            \"ec2:DescribeAddresses\",\r\n                            \"ec2:DescribeInstanceAttribute\",\r\n                            \"ec2:DescribeInstances\",\r\n                            \"ec2:DescribeNatGateways\",\r\n                            \"ec2:DescribeRouteTables\",\r\n                            \"ec2:DisassociateAddress\"\r\n                        ],\r\n                        \"Resource\": [\r\n                            \"*\"\r\n                        ]\r\n                    }\r\n                ]\r\n            }\r\n        }\r\n    ]\r\n```\r\n\r\nTake a look inside the lambda folder for more details on the python there.\r\n\r\n## Once Complete\r\nOnce the tool has completed the CFT will be marked as complete and if you look in the Outputs section you should see a Migration Status of Success.  You can also look at the output of the lambda function in CloudWatch logs.  Once it is completely finished, you can decide to terminate your NAT instance and also delete the Cloudformation Stack to eliminate the lambda.\r\n\r\n## Authors\r\nIn addition to myself, I worked with @ianwilloughby on various permutations of the python pieces of the tool.  If you'd like to run a CLI version of the script, you can take a look at his implementation at https://github.com/ianwilloughby/aws_nat_gateway_converter","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}